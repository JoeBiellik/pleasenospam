version: '3'
services:
  pleasenospam-app:
    image: joebiellik/pleasenospam:1.0.0-app
    restart: always
    container_name: pleasenospam-app
    build:
      context: ./
      dockerfile: ./app/Dockerfile
    depends_on:
     - pleasenospam-mail-server
     - pleasenospam-db
    environment:
     - NODE_ENV=docker
    volumes:
     - pleasenospam-app:/usr/src/app
    ports:
     - "3000:80"
  pleasenospam-mail-server:
    image: joebiellik/pleasenospam:1.0.0-mail-server
    restart: always
    container_name: pleasenospam-mail-server
    build:
      context: ./
      dockerfile: ./mail-server/Dockerfile
    depends_on:
      - pleasenospam-db
    environment:
     - NODE_ENV=docker
    expose:
     - 25
    ports:
     - "2525:25"
  pleasenospam-db:
    image: rethinkdb:latest
    restart: always
    container_name: pleasenospam-db
    volumes:
     - pleasenospam-db:/data
    expose:
     - 28015
    ports:
     - "8080"
     - "28015"
     - "28016"

volumes:
  pleasenospam-db:
